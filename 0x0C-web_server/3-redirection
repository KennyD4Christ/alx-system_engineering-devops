#!/usr/bin/env bash

# Source the previous script for Nginx installation (assuming it's in the same directory)
source 1-install_nginx_web_server

# Redirect configuration path (modify as needed)
redirect_path="/redirect_me"
target_url="https://www.youtube.com/watch?v=QH2-TGUlwu4"

# Modify default server block configuration with sed
sudo sed -i "/location \/$/{a \
  location $redirect_path { \
    return 301 $target_url; \
  }\n}" /etc/nginx/sites-available/default

# Reload Nginx configuration
sudo service nginx reload

# Test the redirect with curl
if curl -sI http://localhost/$redirect_path | grep "301 Moved Permanently"; then
  echo "Nginx redirect for $redirect_path to $target_url is configured successfully!"
else
  echo "There might be an error with the Nginx redirect configuration."
  exit 1
fi
